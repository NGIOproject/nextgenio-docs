

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Modules and Compilers &mdash; nextgenio-docs  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PyCOMPSs" href="pycompss.html" />
    <link rel="prev" title="File Systems and Storage" href="file_systems.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> nextgenio-docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware.html">System Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="connect.html">Connecting to the System</a></li>
<li class="toctree-l1"><a class="reference internal" href="job_scheduler.html">Submitting Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_scheduler.html">Data Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_systems.html">File Systems and Storage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Modules and Compilers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#modules">Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#information-on-the-available-modules">Information on the available modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-unloading-and-swapping-modules">Loading, unloading and swapping modules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#c-c-compilers">C/C++ Compilers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compiling-examples">Compiling Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#openmp">OpenMP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mpi">MPI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fortran-compilers">Fortran Compilers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pycompss.html">PyCOMPSs</a></li>
<li class="toctree-l1"><a class="reference internal" href="perftools.html">Performance Analysis Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQs and Common Issues</a></li>
</ul>
<p class="caption"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apps/castep.html">CASTEP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/halvade.html">Halvade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/openfoam.html">OpenFOAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/ospray.html">OSPRay</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apps/tiramisu.html">Tiramisu</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">nextgenio-docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Modules and Compilers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/user_guide/compilers.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="modules-and-compilers">
<h1>Modules and Compilers<a class="headerlink" href="#modules-and-compilers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="modules">
<h2>Modules<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h2>
<p>The application development environment on NextgenIO is primarily
controlled through <em>modules</em>. By loading and switching
modules users can control the compilers, libraries, and available software.</p>
<p>This means that for compiling on NextgenIO the desired compiler is set by
loading the appropriate module. The required library modules (e.g.
numerical libraries, IO format libraries) should also be loaded.</p>
<p>Additionally, when compiling parallel applications that make use of MPI
it is necessary to ensure one of the MPI environments is loaded.
Compilation should then be performed using the appropriate compiler
wrapper scripts.</p>
<p>Basic usage of the <code class="docutils literal notranslate"><span class="pre">module</span></code> command is covered below. For
full documentation please see the  <a class="reference external" href="http://linux.die.net/man/1/module">Linux manual page on modules</a>.</p>
<div class="section" id="information-on-the-available-modules">
<h3>Information on the available modules<a class="headerlink" href="#information-on-the-available-modules" title="Permalink to this headline">¶</a></h3>
<p>Finding out which modules (and hence which compilers, libraries, and
software) are available on the system is done with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt;  module avail
...
</pre></div>
</div>
<p>This will list all the names and versions of the modules available on
the system. For several modules there is more than one version, each of
which is identified by a version number. One of these versions is
the default, this is the version that will be loaded when requesting
a module by the name only (and not the version number).</p>
<p>You can list all the modules of a particular type by providing an
argument to the <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">avail</span></code> command. For example, to list all
available versions of the MPI library:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; module avail mpi

---------- /opt/ohpc/pub/moduledeps/intel-impi ----------
   mpiP/3.4.1

----------- /opt/ohpc/pub/moduledeps/intel --------------
   impi/2019.3.199 (L)    mpich/3.3    openmpi/1.10.7

------------ /home/software/modulefiles -----------------
   mpi4py/python2-openmpi    mpi4py/python2    mpi4py/python3-openmpi    mpi4py/python3 (D)

   Where:
    D:  Default Module
    L:  Module is loaded
</pre></div>
</div>
<p>If you want more info on any of the modules, you can use the
<code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">help</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; module help impi

---------- Module Specific Help for &quot;impi/2019.3.199&quot; ------------

This module loads the Intel MPI environment

mpiifort     (Fortran source)
mpiicc       (C   source)
mpiicpc      (C++ source)

Version 2019.3.199
</pre></div>
</div>
<p>The simple <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">list</span></code> command will give the names of the modules
and their versions you have presently loaded in your environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; module list

Currently Loaded Modules:
1) autotools   2) prun/1.3   3) intel/19.0.3.199   4) impi/2019.3.199   5) ohpc   6) packages-nextgenio
</pre></div>
</div>
</div>
<div class="section" id="loading-unloading-and-swapping-modules">
<h3>Loading, unloading and swapping modules<a class="headerlink" href="#loading-unloading-and-swapping-modules" title="Permalink to this headline">¶</a></h3>
<p>To load a module to use <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">add</span></code> or <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span></code>. For example,
to load the intel-compilers-17 into the development environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">load</span> <span class="n">openmpi</span>
</pre></div>
</div>
<p>This will load the default openmpi version. If there is more than one
version available, it is possible to specify the version in the
module load command, bypassing the default settings if so desired.</p>
<p>If you want to clean up, <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">remove</span></code> will remove a loaded module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">remove</span> <span class="n">openmpi</span>
</pre></div>
</div>
<p>(or <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">rm</span> <span class="pre">openmpi</span></code> or <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">unload</span> <span class="pre">openmpi</span></code>) will unload
whichever version of openmpi you have loaded.</p>
<p>There are many situations in which you might want to change the presently
loaded version to a different one, such as trying the latest version which
is not yet the default, using a legacy version to keep compatibility with old data,
or because the new module to be loaded is incompatible with the old one.
Swapping can be achieved most easily by using “module swap oldmodule newmodule”.</p>
<p>Suppose you wish to swap <code class="docutils literal notranslate"><span class="pre">openmpi</span></code> for <code class="docutils literal notranslate"><span class="pre">impi</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">module</span> <span class="n">swap</span> <span class="n">openmpi</span> <span class="n">impi</span>
</pre></div>
</div>
<p>In case two modules are incompatible, simply trying to load the conflicting
module will result in an error.</p>
</div>
</div>
<div class="section" id="c-c-compilers">
<h2>C/C++ Compilers<a class="headerlink" href="#c-c-compilers" title="Permalink to this headline">¶</a></h2>
<p>Various compilers are available on NextgenIO. Different
combinations of compilers may be used for applications
using multithreading and/or MPI, although performance may
vary.</p>
<p>The available C/C++ compilers are <code class="docutils literal notranslate"><span class="pre">icc</span></code> (the Intel
compiler) and <code class="docutils literal notranslate"><span class="pre">gcc</span></code> (the GNU compiler), and the available
MPI libraries are <em>openmpi</em> and <em>impi</em> (Intel’s MPI
library). The MPI libraries are used by the compiler
through the <code class="docutils literal notranslate"><span class="pre">mpicc</span></code> and <code class="docutils literal notranslate"><span class="pre">mpigcc</span></code> wrappers, and the
library is selected by loading the relevant module.</p>
<p>The MPI modules are simply named <code class="docutils literal notranslate"><span class="pre">openmpi</span></code> and <code class="docutils literal notranslate"><span class="pre">impi</span></code>.
The modules use <code class="docutils literal notranslate"><span class="pre">icc</span></code> as the standard C/C++ compiler,
but <code class="docutils literal notranslate"><span class="pre">gcc</span></code> is available for both. To switch the compiler
used by the <code class="docutils literal notranslate"><span class="pre">mpicc</span></code> wrapper to <code class="docutils literal notranslate"><span class="pre">gcc</span></code> in the <code class="docutils literal notranslate"><span class="pre">openmpi</span></code>
module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">OMPI_CC</span><span class="o">=</span><span class="n">gcc</span>
</pre></div>
</div>
<p>This option may be the preferred way of using the <code class="docutils literal notranslate"><span class="pre">gcc</span></code>
compiler when running mpi code, as executables created
with the <code class="docutils literal notranslate"><span class="pre">mpigcc</span></code> wrapper appear to have trouble
running on the NextgenIO system.</p>
<p>An (incomplete) overview of flags that can be set for both
<code class="docutils literal notranslate"><span class="pre">mpicc</span></code> and <code class="docutils literal notranslate"><span class="pre">mpigcc</span></code></p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Flag</th>
<th class="head">Implication</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>-o</td>
<td>Specify name of output executable</td>
</tr>
<tr class="row-odd"><td>-g</td>
<td>Enable debugging</td>
</tr>
<tr class="row-even"><td>-fopenmp</td>
<td>Include OpenMP libraries</td>
</tr>
<tr class="row-odd"><td>-O[N]</td>
<td>Set the optimisation level N (=0-3)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="compiling-examples">
<h2>Compiling Examples<a class="headerlink" href="#compiling-examples" title="Permalink to this headline">¶</a></h2>
<p>Below we consider several examples of ways to compile
code that uses multithreading, MPI or a combination of
the two.</p>
<div class="section" id="openmp">
<h3>OpenMP<a class="headerlink" href="#openmp" title="Permalink to this headline">¶</a></h3>
<p>Code including OpenMP based multithreading can be compiled
using <code class="docutils literal notranslate"><span class="pre">gcc</span></code> and the flag <em>-fopenmp</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gcc</span> <span class="n">openmp_code</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span><span class="n">fopenmp</span> <span class="o">-</span><span class="n">o</span> <span class="n">openmp_exec</span>
</pre></div>
</div>
</div>
<div class="section" id="mpi">
<h3>MPI<a class="headerlink" href="#mpi" title="Permalink to this headline">¶</a></h3>
<p>MPI code can be compiled as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpicc</span> <span class="n">mpi_code</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span><span class="n">o</span> <span class="n">mpi_exec</span>
</pre></div>
</div>
<p>And for combined MPI and OpenMP applications:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpicc</span> <span class="n">mix_code</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span><span class="n">fopenmp</span> <span class="o">-</span><span class="n">o</span> <span class="n">mix_exec</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Although there are multiple possible combinations to compile
code on the NextgenIO system, all executables should be able to
run using <em>srun</em> and <em>mpirun</em>  with the job scheduler.</p>
<p>The table below gives a brief summary of compilations setting
combinations that do and do not work with the two executions
command. Only combining <code class="docutils literal notranslate"><span class="pre">mpigcc</span></code> and openmpi results in an
error (<a class="reference internal" href="faq.html#ref-qsymbollookup"><span class="std std-ref">Symbol Lookup Error</span></a>) when executed.</p>
<table border="1" class="last docutils">
<colgroup>
<col width="40%" />
<col width="30%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Compiler Combination</th>
<th class="head">srun</th>
<th class="head">mpirun</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>icc + impi (mpicc)</td>
<td><div class="first last">&#10004;</div></td>
<td><div class="first last">&#10004;</div></td>
</tr>
<tr class="row-odd"><td>gcc + impi (mpicc)</td>
<td><div class="first last">&#10004</div></td>
<td><div class="first last">&#10004</div></td>
</tr>
<tr class="row-even"><td>gcc + impi (mpigcc)</td>
<td><div class="first last">&#10004;</div></td>
<td><div class="first last">&#10004;</div></td>
</tr>
<tr class="row-odd"><td>icc + openmpi (mpicc)</td>
<td><div class="first last">&#10004;</div></td>
<td><div class="first last">&#10004</div></td>
</tr>
<tr class="row-even"><td>gcc + openmpi (mpicc)</td>
<td><div class="first last">&#10004;</div></td>
<td><div class="first last">&#10004;</div></td>
</tr>
<tr class="row-odd"><td>gcc + openmpi (mpigcc)</td>
<td><div class="first last">&#10008;</div></td>
<td><div class="first last">&#10008;</div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="fortran-compilers">
<h2>Fortran Compilers<a class="headerlink" href="#fortran-compilers" title="Permalink to this headline">¶</a></h2>
<p>GNU and Intel Fortran compilers are available on the NextgenIO
system. The compilers are available by default (i.e. no modules
need to be loaded before calling them).</p>
<p>For compilation with the default gnu compiler:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gfortran</span> <span class="n">fort_code</span><span class="o">.</span><span class="n">f</span> <span class="o">-</span><span class="n">o</span> <span class="n">fort_exec</span>
</pre></div>
</div>
<p>To use another version of the GNU compiler use e.g.:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f95</span> <span class="n">fort95_code</span><span class="o">.</span><span class="n">f</span> <span class="o">-</span><span class="n">o</span> <span class="n">fort_exec</span>
</pre></div>
</div>
<p>The use of the Intel compiler is identical:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifort</span> <span class="n">fort_code</span> <span class="o">-</span><span class="n">o</span> <span class="n">fort_exec</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pycompss.html" class="btn btn-neutral float-right" title="PyCOMPSs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="file_systems.html" class="btn btn-neutral float-left" title="File Systems and Storage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, nextgenio_project

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>